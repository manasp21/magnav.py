<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>magnavpy.magnav &#8212; MagNavPy 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=73454398" />
    <script src="../../_static/documentation_options.js?v=01f34227"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">MagNavPy</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=manasp21&repo=magnav.py&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data.html">Flight Path &amp; INS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maps.html">Magnetic Anomaly Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../comp.html">Aeromagnetic Compensation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nncomp.html">Neural Network-Based Model Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nav.html">Navigation Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../status.html">Current Status and Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_functions.html">API: Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_structs.html">API: Structs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for magnavpy.magnav</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Main module for MagNavPy, translated from MagNav.jl.</span>

<span class="sd">This module provides core data structures, constants, utility functions,</span>
<span class="sd">and access to datasets for magnetic navigation.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">toml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>

<span class="c1"># SciPy imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.linalg</span><span class="w"> </span><span class="kn">import</span> <span class="n">expm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">multivariate_normal</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">uniform</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnivariateSpline</span><span class="p">,</span> <span class="n">interp1d</span><span class="p">,</span> <span class="n">RegularGridInterpolator</span><span class="p">,</span> <span class="n">interpn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">loadmat</span><span class="p">,</span> <span class="n">savemat</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">minimize</span> <span class="k">as</span> <span class="n">scipy_minimize</span> <span class="c1"># Renamed to avoid conflict if we define minimize</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.special</span><span class="w"> </span><span class="kn">import</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gammainc</span><span class="p">,</span> <span class="n">gammaincinv</span>

<span class="c1"># Matplotlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># PyTorch imports (Flux equivalent)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.optim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">optim</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch.utils.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn.functional</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">F</span>

<span class="c1"># Scikit-learn imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">ElasticNetCV</span><span class="p">,</span> <span class="n">ElasticNet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">KDTree</span> <span class="k">as</span> <span class="n">SklearnKDTree</span><span class="p">,</span> <span class="n">NearestNeighbors</span> <span class="k">as</span> <span class="n">SklearnNearestNeighbors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics.pairwise</span><span class="w"> </span><span class="kn">import</span> <span class="n">polynomial_kernel</span><span class="p">,</span> <span class="n">rbf_kernel</span>

<span class="c1"># Statsmodels imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.stattools</span><span class="w"> </span><span class="kn">import</span> <span class="n">acf</span> <span class="k">as</span> <span class="n">sm_acf</span> <span class="c1"># Renamed</span>

<span class="c1"># GDAL import</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">gdal</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">gdal</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Placeholder</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: GDAL not found. Some functionalities might be unavailable.&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

<span class="c1"># JAX imports</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
    <span class="c1"># from jax.config import config</span>
    <span class="c1"># config.update(&quot;jax_enable_x64&quot;, True)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">jax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">jnp</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Placeholder</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: JAX not found. Autodiff functionalities might be unavailable.&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

<span class="c1"># MagNavPy sub-module imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.common_types</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Map</span><span class="p">,</span> <span class="n">MapS</span><span class="p">,</span> <span class="n">MapSd</span><span class="p">,</span> <span class="n">MapS3D</span><span class="p">,</span> <span class="n">MapV</span><span class="p">,</span> <span class="n">MagV</span><span class="p">,</span> <span class="n">MapCache</span><span class="p">,</span> <span class="n">MAP_S_NULL</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.tolles_lawson</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_TL_A</span><span class="p">,</span> <span class="n">create_TL_coef</span> <span class="c1"># create_TL_coef might be needed for defaults</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.dcm_util</span><span class="w"> </span><span class="kn">import</span> <span class="n">dcm2euler</span><span class="p">,</span> <span class="n">euler2dcm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.fdm_util</span><span class="w"> </span><span class="kn">import</span> <span class="n">fdm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.signal_util</span><span class="w"> </span><span class="kn">import</span> <span class="n">linreg_matrix</span> <span class="c1"># Assuming this is equivalent to Julia&#39;s linreg(y,x)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.core_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">dn2dlat</span><span class="p">,</span> <span class="n">de2dlon</span><span class="p">,</span> <span class="n">dlat2dn</span><span class="p">,</span> <span class="n">dlon2de</span><span class="p">,</span> <span class="n">get_years</span> <span class="c1"># Import core utilities</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.model_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_f</span><span class="p">,</span> <span class="n">create_P0</span> <span class="k">as</span> <span class="n">model_create_P0</span><span class="p">,</span> <span class="n">create_Qd</span> <span class="k">as</span> <span class="n">model_create_Qd</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Could not import some functions from .model_functions. Defining placeholders.&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;get_f could not be imported from model_functions.&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">model_create_P0</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Default P0 for EKF_RT if model_functions.create_P0 is not available</span>
        <span class="c1"># Based on Julia&#39;s EKF_RT default P = create_P0() which likely initializes a 17x17 matrix</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="mf">1e0</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1e0</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1e1</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>      <span class="c1"># Lat, Lon, Alt</span>
            <span class="mf">1e-1</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1e-1</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1e-1</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># Vn, Ve, Vd</span>
            <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># Tilt n, e, d</span>
            <span class="mf">1e-1</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>                    <span class="c1"># Baro Bias</span>
            <span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="mf">9.81</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="mf">9.81</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="mf">9.81</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># Accel Bias X, Y, Z</span>
            <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># Gyro Bias X, Y, Z</span>
            <span class="mf">1e1</span><span class="o">**</span><span class="mi">2</span>                      <span class="c1"># FOGM Bias</span>
        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">model_create_Qd</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Default Qd for EKF_RT if model_functions.create_Qd is not available</span>
        <span class="c1"># Based on Julia&#39;s EKF_RT default Qd = create_Qd()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># Assuming a default dt for placeholder</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">(</span><span class="mf">1e-8</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mf">1e-8</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mf">1e-1</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># Lat, Lon, Alt</span>
            <span class="p">(</span><span class="mf">1e-3</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mf">1e-3</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mf">1e-3</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># Vn, Ve, Vd</span>
            <span class="p">(</span><span class="mf">1e-7</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mf">1e-7</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mf">1e-7</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># Tilt n, e, d</span>
            <span class="p">(</span><span class="mf">1e-3</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>                             <span class="c1"># Baro Bias</span>
            <span class="p">(</span><span class="mf">1e-4</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mf">1e-4</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mf">1e-4</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># Accel Bias X, Y, Z</span>
            <span class="p">(</span><span class="mf">1e-8</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mf">1e-8</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mf">1e-8</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># Gyro Bias X, Y, Z</span>
            <span class="p">(</span><span class="mf">1e-1</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>                              <span class="c1"># FOGM Bias</span>
        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>


<span class="c1"># --- Project Version ---</span>
<span class="n">_SCRIPT_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">_PROJECT_TOML_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_SCRIPT_DIR</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;MagNav.jl&quot;</span><span class="p">,</span> <span class="s2">&quot;Project.toml&quot;</span><span class="p">)</span>

<span class="n">MAGNAV_VERSION_STR</span> <span class="o">=</span> <span class="s2">&quot;0.0.0&quot;</span> <span class="c1"># Default</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">_PROJECT_TOML_PATH</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">_project_data</span> <span class="o">=</span> <span class="n">toml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">MAGNAV_VERSION_STR</span> <span class="o">=</span> <span class="n">_project_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;0.0.0&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Project.toml not found at </span><span class="si">{</span><span class="n">_PROJECT_TOML_PATH</span><span class="si">}</span><span class="s2">. Using default version.&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Could not read version from Project.toml: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

<span class="c1"># --- Constants ---</span>
<span class="n">NUM_MAG_MAX</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">E_EARTH</span> <span class="o">=</span> <span class="mf">0.0818191908426</span>
<span class="n">G_EARTH</span> <span class="o">=</span> <span class="mf">9.80665</span>
<span class="n">R_EARTH</span> <span class="o">=</span> <span class="mi">6378137</span>
<span class="n">OMEGA_EARTH</span> <span class="o">=</span> <span class="mf">7.2921151467e-5</span>
<span class="n">SILENT_DEBUG</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">_DEFAULT_ARTIFACT_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_SCRIPT_DIR</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;artifacts_data&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Note: Artifact paths are placeholders. Ensure data exists at expected locations relative to &#39;</span><span class="si">{</span><span class="n">_DEFAULT_ARTIFACT_DIR</span><span class="si">}</span><span class="s2">&#39; or configure properly.&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

<span class="n">USGS_COLOR_SCALE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_DEFAULT_ARTIFACT_DIR</span><span class="p">,</span> <span class="s2">&quot;util_files&quot;</span><span class="p">,</span> <span class="s2">&quot;util_files&quot;</span><span class="p">,</span> <span class="s2">&quot;color_scale_usgs.csv&quot;</span><span class="p">)</span>
<span class="n">ICON_CIRCLE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_DEFAULT_ARTIFACT_DIR</span><span class="p">,</span> <span class="s2">&quot;util_files&quot;</span><span class="p">,</span> <span class="s2">&quot;util_files&quot;</span><span class="p">,</span> <span class="s2">&quot;icon_circle.dae&quot;</span><span class="p">)</span>
<span class="n">EMAG2_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_DEFAULT_ARTIFACT_DIR</span><span class="p">,</span> <span class="s2">&quot;EMAG2&quot;</span><span class="p">,</span> <span class="s2">&quot;EMAG2.h5&quot;</span><span class="p">)</span>
<span class="n">EMM720_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_DEFAULT_ARTIFACT_DIR</span><span class="p">,</span> <span class="s2">&quot;EMM720_World&quot;</span><span class="p">,</span> <span class="s2">&quot;EMM720_World.h5&quot;</span><span class="p">)</span>
<span class="n">NAMAD_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_DEFAULT_ARTIFACT_DIR</span><span class="p">,</span> <span class="s2">&quot;NAMAD_305&quot;</span><span class="p">,</span> <span class="s2">&quot;NAMAD_305.h5&quot;</span><span class="p">)</span>

<span class="c1"># --- Helper Functions for path manipulation ---</span>
<div class="viewcode-block" id="add_extension">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.add_extension">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_extension</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ext</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span> <span class="o">+</span> <span class="n">ext</span>
    <span class="k">return</span> <span class="n">name</span></div>


<div class="viewcode-block" id="remove_extension">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.remove_extension">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_extension</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">suffix_to_remove</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix_to_remove</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">suffix_to_remove</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">name</span></div>


<span class="c1"># --- Artifact Path Functions ---</span>
<div class="viewcode-block" id="sgl_fields_path">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.sgl_fields_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sgl_fields_path</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">p_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_DEFAULT_ARTIFACT_DIR</span><span class="p">,</span> <span class="s2">&quot;sgl_fields&quot;</span><span class="p">,</span> <span class="s2">&quot;sgl_fields&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p_base</span><span class="p">,</span> <span class="n">add_extension</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s2">&quot;.csv&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">p_base</span></div>


<div class="viewcode-block" id="sgl_2020_train_path">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.sgl_2020_train_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sgl_2020_train_path</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">p_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_DEFAULT_ARTIFACT_DIR</span><span class="p">,</span> <span class="s2">&quot;sgl_2020_train&quot;</span><span class="p">,</span> <span class="s2">&quot;sgl_2020_train&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">remove_extension</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s2">&quot;_train&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p_base</span><span class="p">,</span> <span class="n">add_extension</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;_train.h5&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">p_base</span></div>


<div class="viewcode-block" id="sgl_2021_train_path">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.sgl_2021_train_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sgl_2021_train_path</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">p_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_DEFAULT_ARTIFACT_DIR</span><span class="p">,</span> <span class="s2">&quot;sgl_2021_train&quot;</span><span class="p">,</span> <span class="s2">&quot;sgl_2021_train&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">remove_extension</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s2">&quot;_train&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p_base</span><span class="p">,</span> <span class="n">add_extension</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;_train.h5&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">p_base</span></div>


<div class="viewcode-block" id="ottawa_area_maps_path">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.ottawa_area_maps_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ottawa_area_maps_path</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">p_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_DEFAULT_ARTIFACT_DIR</span><span class="p">,</span> <span class="s2">&quot;ottawa_area_maps&quot;</span><span class="p">,</span> <span class="s2">&quot;ottawa_area_maps&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p_base</span><span class="p">,</span> <span class="n">add_extension</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s2">&quot;.h5&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">p_base</span></div>


<div class="viewcode-block" id="ottawa_area_maps_gxf_path">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.ottawa_area_maps_gxf_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ottawa_area_maps_gxf_path</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">p_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_DEFAULT_ARTIFACT_DIR</span><span class="p">,</span> <span class="s2">&quot;ottawa_area_maps_gxf&quot;</span><span class="p">,</span> <span class="s2">&quot;ottawa_area_maps_gxf&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">remove_extension</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s2">&quot;_Mag&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p_base</span><span class="p">,</span> <span class="n">add_extension</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;_Mag.gxf&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">p_base</span></div>


<span class="c1"># --- Data Structures ---</span>
<div class="viewcode-block" id="Path">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.Path">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Path</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">tt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">lon</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">alt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">vn</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">ve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">vd</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></div>


<div class="viewcode-block" id="Traj">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.Traj">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Traj</span><span class="p">(</span><span class="n">Path</span><span class="p">):</span>
    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">tt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">lon</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">alt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">vn</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">ve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">vd</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">fe</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">fd</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">Cnb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></div>


<div class="viewcode-block" id="INS">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.INS">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">INS</span><span class="p">(</span><span class="n">Path</span><span class="p">):</span>
    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">tt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">lon</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">alt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">vn</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">ve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">vd</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">fe</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">fd</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">Cnb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">P</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></div>


<div class="viewcode-block" id="XYZ">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.XYZ">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">XYZ</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="n">info</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">traj</span><span class="p">:</span> <span class="n">Traj</span>
    <span class="n">ins</span><span class="p">:</span> <span class="n">INS</span>
    <span class="n">flight</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">line</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">doy</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">diurnal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">igrf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></div>


<div class="viewcode-block" id="XYZ0">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.XYZ0">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">XYZ0</span><span class="p">(</span><span class="n">XYZ</span><span class="p">):</span>
    <span class="n">info</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">traj</span><span class="p">:</span> <span class="n">Traj</span>
    <span class="n">ins</span><span class="p">:</span> <span class="n">INS</span>
    <span class="n">flux_a</span><span class="p">:</span> <span class="n">MagV</span>
    <span class="n">flight</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">line</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">doy</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">diurnal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">igrf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">mag_1_c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">mag_1_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></div>


<div class="viewcode-block" id="XYZ1">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.XYZ1">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">XYZ1</span><span class="p">(</span><span class="n">XYZ</span><span class="p">):</span>
    <span class="n">info</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">traj</span><span class="p">:</span> <span class="n">Traj</span>
    <span class="n">ins</span><span class="p">:</span> <span class="n">INS</span>
    <span class="n">flux_a</span><span class="p">:</span> <span class="n">MagV</span>
    <span class="n">flux_b</span><span class="p">:</span> <span class="n">MagV</span>
    <span class="n">flight</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">line</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">doy</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">diurnal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">igrf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">mag_1_c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">mag_2_c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">mag_3_c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">mag_1_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">mag_2_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">mag_3_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">aux_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">aux_2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">aux_3</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></div>


<div class="viewcode-block" id="XYZ20">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.XYZ20">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">XYZ20</span><span class="p">(</span><span class="n">XYZ</span><span class="p">):</span>
    <span class="n">info</span><span class="p">:</span> <span class="nb">str</span><span class="p">;</span> <span class="n">traj</span><span class="p">:</span> <span class="n">Traj</span><span class="p">;</span> <span class="n">ins</span><span class="p">:</span> <span class="n">INS</span><span class="p">;</span> <span class="n">flux_a</span><span class="p">:</span> <span class="n">MagV</span><span class="p">;</span> <span class="n">flux_b</span><span class="p">:</span> <span class="n">MagV</span><span class="p">;</span> <span class="n">flux_c</span><span class="p">:</span> <span class="n">MagV</span><span class="p">;</span> <span class="n">flux_d</span><span class="p">:</span> <span class="n">MagV</span><span class="p">;</span>
    <span class="n">flight</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">line</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">year</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">doy</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">utm_x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">utm_y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">utm_z</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">msl</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">baro</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">diurnal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">igrf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_1_c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_1_lag</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_1_dc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">mag_1_igrf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_1_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_2_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_3_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">mag_4_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_5_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_6_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ogs_mag</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">ogs_alt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ins_wander</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ins_roll</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ins_pitch</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">ins_yaw</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">roll_rate</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">pitch_rate</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">yaw_rate</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">ins_acc_x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ins_acc_y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ins_acc_z</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">lgtl_acc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">ltrl_acc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">nrml_acc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">pitot_p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">static_p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">total_p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_com_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_ac_hi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_ac_lo</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">cur_tank</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_flap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_strb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_srvo_o</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">cur_srvo_m</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_srvo_i</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_heat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_acpwr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">cur_outpwr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_bat_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_bat_2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_acpwr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">vol_outpwr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_bat_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_bat_2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_res_p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">vol_res_n</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_back_p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_back_n</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_gyro_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">vol_gyro_2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_acc_p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_acc_n</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_block</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">vol_back</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_srvo</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_cabt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_fan</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">aux_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">aux_2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">aux_3</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span></div>


<div class="viewcode-block" id="XYZ21">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.XYZ21">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">XYZ21</span><span class="p">(</span><span class="n">XYZ</span><span class="p">):</span>
    <span class="n">info</span><span class="p">:</span> <span class="nb">str</span><span class="p">;</span> <span class="n">traj</span><span class="p">:</span> <span class="n">Traj</span><span class="p">;</span> <span class="n">ins</span><span class="p">:</span> <span class="n">INS</span><span class="p">;</span> <span class="n">flux_a</span><span class="p">:</span> <span class="n">MagV</span><span class="p">;</span> <span class="n">flux_b</span><span class="p">:</span> <span class="n">MagV</span><span class="p">;</span> <span class="n">flux_c</span><span class="p">:</span> <span class="n">MagV</span><span class="p">;</span> <span class="n">flux_d</span><span class="p">:</span> <span class="n">MagV</span><span class="p">;</span>
    <span class="n">flight</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">line</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">year</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">doy</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">utm_x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">utm_y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">utm_z</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">msl</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">baro</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">diurnal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">igrf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_1_c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_1_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_2_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">mag_3_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_4_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">mag_5_uc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_com_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">cur_ac_hi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_ac_lo</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_tank</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">cur_flap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">cur_strb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_block</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_back</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vol_cabt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">vol_fan</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">aux_1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">aux_2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">aux_3</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span></div>


<div class="viewcode-block" id="FILTres">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.FILTres">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FILTres</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">P</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">r</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">c</span><span class="p">:</span> <span class="nb">bool</span></div>


<div class="viewcode-block" id="CRLBout">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.CRLBout">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CRLBout</span><span class="p">:</span>
    <span class="n">lat_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">lon_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">alt_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">vn_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ve_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vd_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">tn_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">te_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">td_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">fogm_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">n_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">e_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span></div>


<div class="viewcode-block" id="INSout">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.INSout">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">INSout</span><span class="p">:</span>
    <span class="n">lat_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">lon_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">alt_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">n_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">e_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">lat_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">lon_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">alt_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">n_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">e_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span></div>


<div class="viewcode-block" id="FILTout">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.FILTout">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FILTout</span><span class="p">(</span><span class="n">Path</span><span class="p">):</span> <span class="c1"># Path provides N, dt, tt, lat, lon, alt, vn, ve, vd</span>
    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span><span class="p">;</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">;</span> <span class="n">tt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">lon</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">alt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">vn</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vd</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">tn</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">te</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">td</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ha</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ah</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ay</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">az</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">gx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">gy</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">gz</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">fogm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">lat_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">lon_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">alt_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">vn_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ve_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vd_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">tn_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">te_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">td_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ha_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ah_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">ax_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ay_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">az_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">gx_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">gy_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">gz_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">fogm_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">n_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">e_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">lat_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">lon_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">alt_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">vn_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">ve_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">vd_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">tn_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span>
    <span class="n">te_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">td_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">n_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span> <span class="n">e_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">;</span></div>


<div class="viewcode-block" id="CompParams">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.CompParams">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CompParams</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base type for compensation parameters.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">_default_lin_comp_data_norms</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_default_lin_comp_model</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>

<div class="viewcode-block" id="LinCompParams">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.LinCompParams">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LinCompParams</span><span class="p">(</span><span class="n">CompParams</span><span class="p">):</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">MAGNAV_VERSION_STR</span>
    <span class="n">features_setup</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mag_1_uc&#39;</span><span class="p">,</span> <span class="s1">&#39;TL_A_flux_a&#39;</span><span class="p">])</span>
    <span class="n">features_no_norm</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">model_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;plsr&#39;</span>  <span class="c1"># :TL, :mod_TL, :map_TL, :elasticnet, :plsr</span>
    <span class="n">y_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span>  <span class="c1"># :a, :b, :c, :d, :e</span>
    <span class="n">use_mag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;mag_1_uc&#39;</span>
    <span class="n">use_vec</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;flux_a&#39;</span>
    <span class="n">data_norms</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">_default_lin_comp_data_norms</span><span class="p">)</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">_default_lin_comp_model</span><span class="p">)</span>
    <span class="n">terms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;permanent&#39;</span><span class="p">,</span> <span class="s1">&#39;induced&#39;</span><span class="p">,</span> <span class="s1">&#39;eddy&#39;</span><span class="p">])</span>
    <span class="n">terms_A</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;permanent&#39;</span><span class="p">,</span> <span class="s1">&#39;induced&#39;</span><span class="p">,</span> <span class="s1">&#39;eddy&#39;</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">])</span>
    <span class="n">sub_diurnal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">sub_igrf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">bpf_mag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">reorient_vec</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">norm_type_A</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>  <span class="c1"># :standardize, :normalize, :scale, :none</span>
    <span class="n">norm_type_x</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
    <span class="n">norm_type_y</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
    <span class="n">k_plsr</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">18</span>
    <span class="n">lambda_TL</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.025</span>  <span class="c1"># _TL in Julia</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">_default_nn_comp_data_norms</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>

<div class="viewcode-block" id="NNCompParams">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.NNCompParams">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NNCompParams</span><span class="p">(</span><span class="n">CompParams</span><span class="p">):</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">MAGNAV_VERSION_STR</span>
    <span class="n">features_setup</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mag_1_uc&#39;</span><span class="p">,</span> <span class="s1">&#39;TL_A_flux_a&#39;</span><span class="p">])</span>
    <span class="n">features_no_norm</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">model_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;m1&#39;</span> <span class="c1"># :m1, :m2a, :m2b, :m2c, :m2d, :m3tl, :m3s, :m3v, :m3sc, :m3vc, :m3w, :m3tf</span>
    <span class="n">y_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span> <span class="c1"># :a, :b, :c, :d, :e</span>
    <span class="n">use_mag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;mag_1_uc&#39;</span>
    <span class="n">use_vec</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;flux_a&#39;</span>
    <span class="n">data_norms</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">_default_nn_comp_data_norms</span><span class="p">)</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">)</span>
    <span class="n">terms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;permanent&#39;</span><span class="p">,</span> <span class="s1">&#39;induced&#39;</span><span class="p">,</span> <span class="s1">&#39;eddy&#39;</span><span class="p">])</span>
    <span class="n">terms_A</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;permanent&#39;</span><span class="p">,</span> <span class="s1">&#39;induced&#39;</span><span class="p">,</span> <span class="s1">&#39;eddy&#39;</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">])</span>
    <span class="n">sub_diurnal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">sub_igrf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">bpf_mag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">reorient_vec</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">norm_type_A</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span> <span class="c1"># :standardize, :normalize, :scale, :none</span>
    <span class="n">norm_type_x</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;standardize&#39;</span>
    <span class="n">norm_type_y</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;standardize&#39;</span>
    <span class="n">TL_coef</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
    <span class="n">eta_adam</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="n">epoch_adam</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">epoch_lbfgs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">hidden</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">])</span>
    <span class="n">activation</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">silu</span> <span class="c1"># Corresponds to swish</span>
    <span class="n">loss</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span>
    <span class="n">batchsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span>
    <span class="n">frac_train</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">14</span><span class="o">/</span><span class="mi">17</span>
    <span class="n">alpha_sgl</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># _sgl in Julia</span>
    <span class="n">lambda_sgl</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># _sgl in Julia</span>
    <span class="n">k_pca</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">drop_fi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">drop_fi_bson</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;drop_fi&quot;</span>
    <span class="n">drop_fi_csv</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;drop_fi&quot;</span>
    <span class="n">perm_fi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">perm_fi_csv</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;perm_fi&quot;</span></div>


<div class="viewcode-block" id="TempParams">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.TempParams">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TempParams</span><span class="p">:</span>
    <span class="n">sigma_curriculum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># _curriculum in Julia</span>
    <span class="n">l_window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">window_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sliding&#39;</span> <span class="c1"># :sliding, :contiguous</span>
    <span class="n">tf_layer_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;postlayer&#39;</span> <span class="c1"># :prelayer, :postlayer</span>
    <span class="n">tf_norm_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;batch&#39;</span> <span class="c1"># :batch, :layer, :none</span>
    <span class="n">dropout_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">N_tf_head</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">tf_gain</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_default_ekf_rt_date</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="c1"># Corresponds to Julia&#39;s get_years(2020,185)</span>
    <span class="c1"># Simplified: (year - 1) + (day_of_year / days_in_year)</span>
    <span class="c1"># For simplicity, using a fixed value, proper get_years would be better.</span>
    <span class="k">return</span> <span class="mi">2020</span> <span class="o">+</span> <span class="p">(</span><span class="mi">185</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">366.0</span> <span class="c1"># 2020 is a leap year</span>

<div class="viewcode-block" id="EKF_RT">
<a class="viewcode-back" href="../../api_structs.html#magnavpy.magnav.EKF_RT">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EKF_RT</span><span class="p">:</span>
    <span class="n">P</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">model_create_P0</span><span class="p">)</span>
    <span class="n">Qd</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">model_create_Qd</span><span class="p">)</span>
    <span class="n">R</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">baro_tau</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3600.0</span>
    <span class="n">acc_tau</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3600.0</span>
    <span class="n">gyro_tau</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3600.0</span>
    <span class="n">fogm_tau</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">600.0</span>
    <span class="n">date</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">_get_default_ekf_rt_date</span><span class="p">)</span>
    <span class="n">core</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">nx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ny</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">r</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span></div>


<span class="c1"># --- Utility Functions (ported from analysis_util.jl) ---</span>
<span class="c1"># dn2dlat, de2dlon, dlat2dn, dlon2de moved to core_utils.py</span>

<div class="viewcode-block" id="linreg_vector">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.linreg_vector">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">linreg_vector</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">lambda_val</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Linear regression to determine best fit line for x = eachindex(y).&quot;&quot;&quot;</span>
    <span class="n">x_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">linreg_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x_mat</span><span class="p">,</span> <span class="n">lambda_val</span><span class="o">=</span><span class="n">lambda_val</span><span class="p">)</span></div>


<div class="viewcode-block" id="detrend">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.magnav.detrend">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">detrend</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lambda_val</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mean_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detrend signal (remove mean and optionally slope).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mean_only</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_mat</span> <span class="o">=</span> <span class="n">x</span>
        
        <span class="k">if</span> <span class="n">x_mat</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
             <span class="n">x_mat_for_reg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">x_mat</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Assuming x is already a matrix where columns are features, add intercept</span>
            <span class="n">x_mat_for_reg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="mi">1</span><span class="p">)),</span> <span class="n">x_mat</span><span class="p">])</span>

        <span class="n">coef</span> <span class="o">=</span> <span class="n">linreg_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x_mat_for_reg</span><span class="p">,</span> <span class="n">lambda_val</span><span class="o">=</span><span class="n">lambda_val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x_mat_for_reg</span> <span class="o">@</span> <span class="n">coef</span></div>


<span class="c1"># --- Main Functions ---</span>
<div class="viewcode-block" id="run_filt">
<a class="viewcode-back" href="../../nav.html#magnavpy.magnav.run_filt">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">run_filt</span><span class="p">(</span><span class="n">ins</span><span class="p">:</span> <span class="n">INS</span><span class="p">,</span> <span class="n">xyz</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">XYZ0</span><span class="p">,</span> <span class="n">XYZ1</span><span class="p">,</span> <span class="n">XYZ20</span><span class="p">,</span> <span class="n">XYZ21</span><span class="p">],</span> <span class="n">filter_params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
             <span class="n">mag_map</span><span class="p">:</span> <span class="n">MapS</span> <span class="o">=</span> <span class="n">MAP_S_NULL</span><span class="p">,</span> <span class="n">temp_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TempParams</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FILTres</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs the specified filter (Extended Kalman Filter or Neural EKF for now)</span>
<span class="sd">    and returns its results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This function&#39;s full implementation depends on ekf.py</span>
    <span class="c1"># For now, it&#39;s a placeholder calling a potential ekf function.</span>
    <span class="c1"># from .ekf import ekf # Ensure ekf is importable</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_params</span><span class="p">,</span> <span class="n">EKF_RT</span><span class="p">):</span>
        <span class="c1"># The actual ekf function needs to be implemented/imported from .ekf</span>
        <span class="c1"># x_est, P_est, r_val, converged = ekf(ins, xyz, filter_params, mag_map) # Hypothetical call</span>
        <span class="c1"># return FILTres(x=x_est, P=P_est, r=r_val, c=converged)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Full EKF execution from .ekf module is not yet integrated here.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Only EKF_RT is currently supported as filter_params type.&quot;</span><span class="p">)</span></div>



<span class="c1"># --- Public API ---</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Constants</span>
    <span class="s2">&quot;NUM_MAG_MAX&quot;</span><span class="p">,</span> <span class="s2">&quot;E_EARTH&quot;</span><span class="p">,</span> <span class="s2">&quot;G_EARTH&quot;</span><span class="p">,</span> <span class="s2">&quot;R_EARTH&quot;</span><span class="p">,</span> <span class="s2">&quot;OMEGA_EARTH&quot;</span><span class="p">,</span> <span class="s2">&quot;MAGNAV_VERSION_STR&quot;</span><span class="p">,</span>
    <span class="s2">&quot;USGS_COLOR_SCALE&quot;</span><span class="p">,</span> <span class="s2">&quot;ICON_CIRCLE&quot;</span><span class="p">,</span> <span class="s2">&quot;SILENT_DEBUG&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EMAG2_PATH&quot;</span><span class="p">,</span> <span class="s2">&quot;EMM720_PATH&quot;</span><span class="p">,</span> <span class="s2">&quot;NAMAD_PATH&quot;</span><span class="p">,</span>
    <span class="c1"># Path Functions</span>
    <span class="s2">&quot;sgl_fields_path&quot;</span><span class="p">,</span> <span class="s2">&quot;sgl_2020_train_path&quot;</span><span class="p">,</span> <span class="s2">&quot;sgl_2021_train_path&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ottawa_area_maps_path&quot;</span><span class="p">,</span> <span class="s2">&quot;ottawa_area_maps_gxf_path&quot;</span><span class="p">,</span>
    <span class="c1"># Core Data Structures (Local)</span>
    <span class="s2">&quot;Path&quot;</span><span class="p">,</span> <span class="s2">&quot;Traj&quot;</span><span class="p">,</span> <span class="s2">&quot;INS&quot;</span><span class="p">,</span> <span class="s2">&quot;XYZ&quot;</span><span class="p">,</span> <span class="s2">&quot;XYZ0&quot;</span><span class="p">,</span> <span class="s2">&quot;XYZ1&quot;</span><span class="p">,</span> <span class="s2">&quot;XYZ20&quot;</span><span class="p">,</span> <span class="s2">&quot;XYZ21&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FILTres&quot;</span><span class="p">,</span> <span class="s2">&quot;CRLBout&quot;</span><span class="p">,</span> <span class="s2">&quot;INSout&quot;</span><span class="p">,</span> <span class="s2">&quot;FILTout&quot;</span><span class="p">,</span>
    <span class="c1"># Parameter Data Structures (Local)</span>
    <span class="s2">&quot;CompParams&quot;</span><span class="p">,</span> <span class="s2">&quot;LinCompParams&quot;</span><span class="p">,</span> <span class="s2">&quot;NNCompParams&quot;</span><span class="p">,</span> <span class="s2">&quot;TempParams&quot;</span><span class="p">,</span> <span class="s2">&quot;EKF_RT&quot;</span><span class="p">,</span>
    <span class="c1"># Data Structures (Imported from common_types)</span>
    <span class="s2">&quot;Map&quot;</span><span class="p">,</span> <span class="s2">&quot;MapS&quot;</span><span class="p">,</span> <span class="s2">&quot;MapSd&quot;</span><span class="p">,</span> <span class="s2">&quot;MapS3D&quot;</span><span class="p">,</span> <span class="s2">&quot;MapV&quot;</span><span class="p">,</span> <span class="s2">&quot;MagV&quot;</span><span class="p">,</span> <span class="s2">&quot;MapCache&quot;</span><span class="p">,</span> <span class="s2">&quot;MAP_S_NULL&quot;</span><span class="p">,</span>
    <span class="c1"># Utility Functions (Local)</span>
    <span class="s2">&quot;add_extension&quot;</span><span class="p">,</span> <span class="s2">&quot;remove_extension&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dn2dlat&quot;</span><span class="p">,</span> <span class="s2">&quot;de2dlon&quot;</span><span class="p">,</span> <span class="s2">&quot;dlat2dn&quot;</span><span class="p">,</span> <span class="s2">&quot;dlon2de&quot;</span><span class="p">,</span> <span class="s2">&quot;linreg_vector&quot;</span><span class="p">,</span> <span class="s2">&quot;detrend&quot;</span><span class="p">,</span>
    <span class="c1"># Key Functions (Imported from submodules - for convenience, matching Julia&#39;s exports)</span>
    <span class="s2">&quot;dcm2euler&quot;</span><span class="p">,</span> <span class="s2">&quot;euler2dcm&quot;</span><span class="p">,</span>  <span class="c1"># from .dcm_util</span>
    <span class="s2">&quot;fdm&quot;</span><span class="p">,</span>  <span class="c1"># from .fdm_util</span>
    <span class="s2">&quot;create_TL_A&quot;</span><span class="p">,</span> <span class="s2">&quot;create_TL_coef&quot;</span><span class="p">,</span> <span class="c1"># from .tolles_lawson</span>
    <span class="s2">&quot;linreg_matrix&quot;</span><span class="p">,</span> <span class="c1"># from .signal_util</span>
    <span class="c1"># Main functions (stubs or to be fully implemented)</span>
    <span class="s2">&quot;run_filt&quot;</span><span class="p">,</span>
    <span class="c1"># Potentially more from other modules if they become central &amp; frequently used</span>
    <span class="c1"># &quot;create_model&quot;, &quot;ekf&quot;, &quot;crlb&quot;, &quot;get_map&quot;, etc.</span>
<span class="p">]</span>
</pre></div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2020-2023, Original MagNav.jl Authors; 2024-2025, Manas Pandey.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>