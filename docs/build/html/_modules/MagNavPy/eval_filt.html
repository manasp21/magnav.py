<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>magnavpy.eval_filt &#8212; MagNavPy 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=73454398" />
    <script src="../../_static/documentation_options.js?v=01f34227"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">MagNavPy</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=manasp21&repo=magnav.py&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data.html">Flight Path &amp; INS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maps.html">Magnetic Anomaly Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../comp.html">Aeromagnetic Compensation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nncomp.html">Neural Network-Based Model Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nav.html">Navigation Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../status.html">Current Status and Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_functions.html">API: Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_structs.html">API: Structs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for magnavpy.eval_filt</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for evaluating navigation filter performance.</span>
<span class="sd">Ported from MagNav.jl/src/eval_filt.jl</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Callable</span> <span class="c1"># Added Dict, Callable</span>

<span class="c1"># Assuming these types are defined elsewhere, e.g., in common_types.py or magnav.py</span>
<span class="c1"># from .common_types import Traj, INS, MagV, FILTres # Example</span>
<span class="c1"># from .nav_utils import dlat2dn, dlon2de # Example</span>
<span class="c1"># from .ekf import ekf_py, ekf_online_py, ekf_online_nn_py # Example placeholders for filters</span>
<span class="c1"># from .crlb import crlb_py # Example placeholder for crlb</span>

<span class="c1"># Placeholder for actual type definitions until they are confirmed</span>
<div class="viewcode-block" id="Traj">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.Traj">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Traj</span><span class="p">:</span>
    <span class="n">lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">lon</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">alt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">vn</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">ve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">vd</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">Cnb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="c1"># Shape (N, 3, 3) or (3, 3, N) - assuming (N,3,3) for consistency</span>
    <span class="n">tt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span></div>


<div class="viewcode-block" id="INS">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.INS">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">INS</span><span class="p">:</span>
    <span class="n">lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">lon</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">alt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">vn</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">ve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">vd</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">Cnb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="c1"># Shape (N, 3, 3) or (3, 3, N)</span>
    <span class="n">P</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Covariance matrix (num_states, num_states, N)</span></div>

    <span class="c1"># Add other fields as necessary, e.g., time &#39;tt&#39;</span>

<div class="viewcode-block" id="MagV">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.MagV">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MagV</span><span class="p">:</span> <span class="c1"># Placeholder</span>
    <span class="n">fx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]))</span>
    <span class="n">fy</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]))</span>
    <span class="n">fz</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]))</span>
    <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]))</span></div>


<div class="viewcode-block" id="FILTres">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.FILTres">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FILTres</span><span class="p">:</span> <span class="c1"># Filter results (input to eval_filt_py)</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="c1"># State corrections (num_states, N)</span>
    <span class="n">P</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="c1"># Covariance matrix (num_states, num_states, N)</span></div>

    <span class="c1"># Add other fields if the filter returns more, e.g., filter_type</span>

<span class="c1"># Placeholder for utility functions (normally imported)</span>
<div class="viewcode-block" id="dlat2dn">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.dlat2dn">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">dlat2dn</span><span class="p">(</span><span class="n">dlat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="n">R0</span> <span class="o">=</span> <span class="mf">6378137.0</span>  <span class="c1"># WGS84 Equatorial radius</span>
    <span class="k">return</span> <span class="n">dlat</span> <span class="o">*</span> <span class="p">(</span><span class="n">R0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">0.00669437999014</span><span class="p">))</span> <span class="c1"># Simplified, use proper nav_utils</span></div>


<div class="viewcode-block" id="dlon2de">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.dlon2de">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">dlon2de</span><span class="p">(</span><span class="n">dlon</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="n">R0</span> <span class="o">=</span> <span class="mf">6378137.0</span>  <span class="c1"># WGS84 Equatorial radius</span>
    <span class="k">return</span> <span class="n">dlon</span> <span class="o">*</span> <span class="p">(</span><span class="n">R0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">0.00669437999014</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span> <span class="c1"># Simplified</span></div>


<div class="viewcode-block" id="get_years">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.get_years">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_years</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">day_of_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="c1"># Placeholder</span>
    <span class="k">return</span> <span class="n">year</span> <span class="o">+</span> <span class="p">(</span><span class="n">day_of_year</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">365.25</span></div>


<span class="c1"># --- Output Dataclasses ---</span>
<div class="viewcode-block" id="CRLBout">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.CRLBout">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CRLBout</span><span class="p">:</span>
    <span class="n">lat_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">lon_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">alt_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">vn_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">ve_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">vd_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">tn_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">te_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">td_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">fogm_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">n_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">e_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span></div>


<div class="viewcode-block" id="INSout">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.INSout">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">INSout</span><span class="p">:</span>
    <span class="n">lat_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">lon_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">alt_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">n_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">e_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">lat_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">lon_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">alt_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">n_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">e_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span></div>


<div class="viewcode-block" id="FILTout">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.FILTout">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FILTout</span><span class="p">:</span>
    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">tt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">lon</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">alt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">vn</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">ve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">vd</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">tn</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">te</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">td</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">ha</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span> <span class="c1"># baro_bias</span>
    <span class="n">ah</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span> <span class="c1"># alt_bias (was δhb)</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span> <span class="c1"># acc_bias_x</span>
    <span class="n">ay</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span> <span class="c1"># acc_bias_y</span>
    <span class="n">az</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span> <span class="c1"># acc_bias_z</span>
    <span class="n">gx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span> <span class="c1"># gyro_bias_x</span>
    <span class="n">gy</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span> <span class="c1"># gyro_bias_y</span>
    <span class="n">gz</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span> <span class="c1"># gyro_bias_z</span>
    <span class="n">fogm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span> <span class="c1"># fogm_bias</span>

    <span class="n">lat_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">lon_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">alt_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">vn_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">ve_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">vd_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">tn_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">te_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">td_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">ha_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">ah_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">ax_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">ay_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">az_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">gx_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">gy_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">gz_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">fogm_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">n_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">e_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>

    <span class="n">lat_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">lon_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">alt_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">vn_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">ve_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">vd_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">tn_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">te_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">td_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">n_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">e_err</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Initialize arrays if N is known, otherwise they remain empty</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">array_fields</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataclass_fields__</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">default_factory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">array_fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;dt&#39;</span><span class="p">]:</span> <span class="c1"># N, dt are not arrays to be sized</span>
                    <span class="c1"># Check if field already has data (e.g. tt from traj)</span>
                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">))</span></div>



<div class="viewcode-block" id="eval_crlb_py">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.eval_crlb_py">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">eval_crlb_py</span><span class="p">(</span><span class="n">traj</span><span class="p">:</span> <span class="n">Traj</span><span class="p">,</span> <span class="n">crlb_P</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CRLBout</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract Cramér–Rao lower bound (CRLB) results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">N</span>
    <span class="n">crlb_out</span> <span class="o">=</span> <span class="n">CRLBout</span><span class="p">()</span>

    <span class="c1"># Assuming crlb_P is (num_states, num_states, N)</span>
    <span class="c1"># State indices: 0:lat, 1:lon, 2:alt, 3:vn, 4:ve, 5:vd, 6:tn, 7:te, 8:td ... 17:fogm</span>
    <span class="n">crlb_out</span><span class="o">.</span><span class="n">lat_std</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">crlb_P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:])</span>
    <span class="n">crlb_out</span><span class="o">.</span><span class="n">lon_std</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">crlb_P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:])</span>
    <span class="n">crlb_out</span><span class="o">.</span><span class="n">alt_std</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">crlb_P</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,:])</span>
    <span class="n">crlb_out</span><span class="o">.</span><span class="n">vn_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">crlb_P</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,:])</span>
    <span class="n">crlb_out</span><span class="o">.</span><span class="n">ve_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">crlb_P</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,:])</span>
    <span class="n">crlb_out</span><span class="o">.</span><span class="n">vd_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">crlb_P</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,:])</span>
    <span class="n">crlb_out</span><span class="o">.</span><span class="n">tn_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">crlb_P</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,:])</span>
    <span class="n">crlb_out</span><span class="o">.</span><span class="n">te_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">crlb_P</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">,:])</span>
    <span class="n">crlb_out</span><span class="o">.</span><span class="n">td_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">crlb_P</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,:])</span>
    <span class="c1"># Assuming 18 states total, fogm is state 17 (0-indexed)</span>
    <span class="k">if</span> <span class="n">crlb_P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">17</span><span class="p">:</span>
         <span class="n">crlb_out</span><span class="o">.</span><span class="n">fogm_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">crlb_P</span><span class="p">[</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">,:])</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># Handle cases with fewer states if necessary</span>
        <span class="n">crlb_out</span><span class="o">.</span><span class="n">fogm_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>


    <span class="n">crlb_out</span><span class="o">.</span><span class="n">n_std</span> <span class="o">=</span> <span class="n">dlat2dn</span><span class="p">(</span><span class="n">crlb_out</span><span class="o">.</span><span class="n">lat_std</span><span class="p">,</span> <span class="n">traj</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
    <span class="n">crlb_out</span><span class="o">.</span><span class="n">e_std</span> <span class="o">=</span> <span class="n">dlon2de</span><span class="p">(</span><span class="n">crlb_out</span><span class="o">.</span><span class="n">lon_std</span><span class="p">,</span> <span class="n">traj</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>

    <span class="n">crlb_DRMS</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">crlb_out</span><span class="o">.</span><span class="n">n_std</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">crlb_out</span><span class="o">.</span><span class="n">e_std</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CRLB DRMS error = </span><span class="si">{</span><span class="n">crlb_DRMS</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">crlb_out</span></div>


<div class="viewcode-block" id="eval_ins_py">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.eval_ins_py">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">eval_ins_py</span><span class="p">(</span><span class="n">traj</span><span class="p">:</span> <span class="n">Traj</span><span class="p">,</span> <span class="n">ins</span><span class="p">:</span> <span class="n">INS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">INSout</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract INS results and compare with trajectory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">N</span>
    <span class="n">ins_out</span> <span class="o">=</span> <span class="n">INSout</span><span class="p">()</span>

    <span class="c1"># Initialize arrays</span>
    <span class="n">ins_out</span><span class="o">.</span><span class="n">lat_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">ins_out</span><span class="o">.</span><span class="n">lon_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">ins_out</span><span class="o">.</span><span class="n">alt_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">ins_out</span><span class="o">.</span><span class="n">n_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">ins_out</span><span class="o">.</span><span class="n">e_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ins</span><span class="o">.</span><span class="n">P</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ins</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ins_out</span><span class="o">.</span><span class="n">lat_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:])</span>
        <span class="n">ins_out</span><span class="o">.</span><span class="n">lon_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:])</span>
        <span class="n">ins_out</span><span class="o">.</span><span class="n">alt_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,:])</span>
        <span class="n">ins_out</span><span class="o">.</span><span class="n">n_std</span>   <span class="o">=</span> <span class="n">dlat2dn</span><span class="p">(</span><span class="n">ins_out</span><span class="o">.</span><span class="n">lat_std</span><span class="p">,</span> <span class="n">ins</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">ins_out</span><span class="o">.</span><span class="n">e_std</span>   <span class="o">=</span> <span class="n">dlon2de</span><span class="p">(</span><span class="n">ins_out</span><span class="o">.</span><span class="n">lon_std</span><span class="p">,</span> <span class="n">ins</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>

    <span class="n">ins_out</span><span class="o">.</span><span class="n">lat_err</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">lat</span> <span class="o">-</span> <span class="n">traj</span><span class="o">.</span><span class="n">lat</span>
    <span class="n">ins_out</span><span class="o">.</span><span class="n">lon_err</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">lon</span> <span class="o">-</span> <span class="n">traj</span><span class="o">.</span><span class="n">lon</span>
    <span class="n">ins_out</span><span class="o">.</span><span class="n">alt_err</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">alt</span> <span class="o">-</span> <span class="n">traj</span><span class="o">.</span><span class="n">alt</span>
    <span class="n">ins_out</span><span class="o">.</span><span class="n">n_err</span>   <span class="o">=</span> <span class="n">dlat2dn</span><span class="p">(</span><span class="n">ins_out</span><span class="o">.</span><span class="n">lat_err</span><span class="p">,</span> <span class="n">ins</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
    <span class="n">ins_out</span><span class="o">.</span><span class="n">e_err</span>   <span class="o">=</span> <span class="n">dlon2de</span><span class="p">(</span><span class="n">ins_out</span><span class="o">.</span><span class="n">lon_err</span><span class="p">,</span> <span class="n">ins</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>

    <span class="n">ins_DRMS</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ins_out</span><span class="o">.</span><span class="n">n_err</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ins_out</span><span class="o">.</span><span class="n">e_err</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INS  DRMS error = </span><span class="si">{</span><span class="n">ins_DRMS</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ins_out</span></div>


<div class="viewcode-block" id="eval_filt_py">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.eval_filt_py">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">eval_filt_py</span><span class="p">(</span><span class="n">traj</span><span class="p">:</span> <span class="n">Traj</span><span class="p">,</span> <span class="n">ins</span><span class="p">:</span> <span class="n">INS</span><span class="p">,</span> <span class="n">filt_res</span><span class="p">:</span> <span class="n">FILTres</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FILTout</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract filter results, combine with INS, and compare with trajectory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span>  <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">N</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">dt</span>
    <span class="n">filt_out</span> <span class="o">=</span> <span class="n">FILTout</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span> <span class="c1"># Initializes arrays via __post_init__</span>

    <span class="n">filt_out</span><span class="o">.</span><span class="n">tt</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">tt</span>

    <span class="c1"># Corrected states (INS + filter estimate)</span>
    <span class="c1"># filt_res.x is (num_states, N)</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">lat</span> <span class="o">+</span> <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">lon</span> <span class="o">+</span> <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">alt</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">alt</span> <span class="o">+</span> <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">vn</span>  <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">vn</span>  <span class="o">+</span> <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">,:]</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">ve</span>  <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">ve</span>  <span class="o">+</span> <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">,:]</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">vd</span>  <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">vd</span>  <span class="o">+</span> <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">,:]</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">tn</span>  <span class="o">=</span>           <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">,:]</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">te</span>  <span class="o">=</span>           <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">7</span><span class="p">,:]</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">td</span>  <span class="o">=</span>           <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">8</span><span class="p">,:]</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">ha</span>  <span class="o">=</span>           <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">9</span><span class="p">,:]</span>  <span class="c1"># baro_bias</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">ah</span>  <span class="o">=</span>           <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">,:]</span> <span class="c1"># alt_bias (δhb)</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">ax</span>  <span class="o">=</span>           <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">11</span><span class="p">,:]</span> <span class="c1"># acc_bias_x</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">ay</span>  <span class="o">=</span>           <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">12</span><span class="p">,:]</span> <span class="c1"># acc_bias_y</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">az</span>  <span class="o">=</span>           <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">13</span><span class="p">,:]</span> <span class="c1"># acc_bias_z</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">gx</span>  <span class="o">=</span>           <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">14</span><span class="p">,:]</span> <span class="c1"># gyro_bias_x</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">gy</span>  <span class="o">=</span>           <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">15</span><span class="p">,:]</span> <span class="c1"># gyro_bias_y</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">gz</span>  <span class="o">=</span>           <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">16</span><span class="p">,:]</span> <span class="c1"># gyro_bias_z</span>
    <span class="k">if</span> <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">17</span><span class="p">:</span> <span class="c1"># Check if FOGM state exists</span>
        <span class="n">filt_out</span><span class="o">.</span><span class="n">fogm</span> <span class="o">=</span> <span class="n">filt_res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">17</span><span class="p">,:]</span> <span class="c1"># fogm_bias</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filt_out</span><span class="o">.</span><span class="n">fogm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>


    <span class="c1"># Standard deviations from filter covariance P</span>
    <span class="c1"># filt_res.P is (num_states, num_states, N)</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">lat_std</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">lon_std</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">alt_std</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">vn_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">ve_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">vd_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">tn_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">te_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">td_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">ha_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">ah_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">ax_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">11</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">ay_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">az_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">13</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">gx_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">14</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">gy_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">,:])</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">gz_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">,:])</span>
    <span class="k">if</span> <span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">17</span><span class="p">:</span>
        <span class="n">filt_out</span><span class="o">.</span><span class="n">fogm_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">filt_res</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">,:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filt_out</span><span class="o">.</span><span class="n">fogm_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>


    <span class="n">filt_out</span><span class="o">.</span><span class="n">n_std</span> <span class="o">=</span> <span class="n">dlat2dn</span><span class="p">(</span><span class="n">filt_out</span><span class="o">.</span><span class="n">lat_std</span><span class="p">,</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">e_std</span> <span class="o">=</span> <span class="n">dlon2de</span><span class="p">(</span><span class="n">filt_out</span><span class="o">.</span><span class="n">lon_std</span><span class="p">,</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>

    <span class="c1"># Errors (Filter - Trajectory)</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">lat_err</span> <span class="o">=</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">lat</span> <span class="o">-</span> <span class="n">traj</span><span class="o">.</span><span class="n">lat</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">lon_err</span> <span class="o">=</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">lon</span> <span class="o">-</span> <span class="n">traj</span><span class="o">.</span><span class="n">lon</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">alt_err</span> <span class="o">=</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">alt</span> <span class="o">-</span> <span class="n">traj</span><span class="o">.</span><span class="n">alt</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">vn_err</span>  <span class="o">=</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">vn</span>  <span class="o">-</span> <span class="n">traj</span><span class="o">.</span><span class="n">vn</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">ve_err</span>  <span class="o">=</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">ve</span>  <span class="o">-</span> <span class="n">traj</span><span class="o">.</span><span class="n">ve</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">vd_err</span>  <span class="o">=</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">vd</span>  <span class="o">-</span> <span class="n">traj</span><span class="o">.</span><span class="n">vd</span>

    <span class="c1"># Attitude errors</span>
    <span class="c1"># ins.Cnb and traj.Cnb are assumed (N, 3, 3)</span>
    <span class="n">n_tilt_truth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">e_tilt_truth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">d_tilt_truth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="c1"># Error DCM: C_filter_to_truth = C_body_to_filter @ C_truth_to_body</span>
        <span class="c1"># C_body_to_filter is approximated by ins.Cnb (or could be derived from filter attitude)</span>
        <span class="c1"># Here, we use ins.Cnb as the reference for filter&#39;s body frame,</span>
        <span class="c1"># and traj.Cnb as the truth for body frame.</span>
        <span class="c1"># The filter&#39;s attitude tn, te, td are corrections to the INS attitude.</span>
        <span class="c1"># So, the &quot;true&quot; tilt errors are against the INS&#39;s error w.r.t trajectory.</span>
        <span class="c1"># tilt_temp = ins.Cnb[k] @ traj.Cnb[k].T # This is C_nav_ins w.r.t nav_truth</span>
        
        <span class="c1"># The Julia code calculates tilt error of INS relative to Trajectory</span>
        <span class="c1"># Cnb_ins = ins.Cnb[k,:,:]</span>
        <span class="c1"># Cnb_traj = traj.Cnb[k,:,:]</span>
        <span class="c1"># tilt_temp_dcm = Cnb_ins @ Cnb_traj.T</span>
        
        <span class="c1"># Let&#39;s assume ins.Cnb is the Cnb used by the filter as its reference.</span>
        <span class="c1"># The filter estimates tn, te, td as the misalignment of this reference.</span>
        <span class="c1"># The &quot;truth&quot; for these tn, te, td values is the actual misalignment of ins.Cnb wrt traj.Cnb</span>
        
        <span class="c1"># If ins.Cnb is (N,3,3)</span>
        <span class="n">Cnb_ins_k</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">Cnb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">Cnb_traj_k</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">Cnb</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        
        <span class="c1"># If ins.Cnb is (3,3,N)</span>
        <span class="c1"># Cnb_ins_k = ins.Cnb[:,:,k]</span>
        <span class="c1"># Cnb_traj_k = traj.Cnb[:,:,k]</span>

        <span class="n">err_dcm</span> <span class="o">=</span> <span class="n">Cnb_ins_k</span> <span class="o">@</span> <span class="n">Cnb_traj_k</span><span class="o">.</span><span class="n">T</span> <span class="c1"># Error DCM of INS relative to Trajectory</span>
        <span class="n">n_tilt_truth</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">err_dcm</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># tilt_temp[2,1] in 0-indexed for Julia&#39;s [3,2]</span>
        <span class="n">e_tilt_truth</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">err_dcm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># tilt_temp[0,2] in 0-indexed for Julia&#39;s [1,3]</span>
        <span class="n">d_tilt_truth</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">err_dcm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># tilt_temp[1,0] in 0-indexed for Julia&#39;s [2,1]</span>

    <span class="n">filt_out</span><span class="o">.</span><span class="n">tn_err</span> <span class="o">=</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">tn</span> <span class="o">-</span> <span class="n">n_tilt_truth</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">te_err</span> <span class="o">=</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">te</span> <span class="o">-</span> <span class="n">e_tilt_truth</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">td_err</span> <span class="o">=</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">td</span> <span class="o">-</span> <span class="n">d_tilt_truth</span>

    <span class="n">filt_out</span><span class="o">.</span><span class="n">n_err</span> <span class="o">=</span> <span class="n">dlat2dn</span><span class="p">(</span><span class="n">filt_out</span><span class="o">.</span><span class="n">lat_err</span><span class="p">,</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
    <span class="n">filt_out</span><span class="o">.</span><span class="n">e_err</span> <span class="o">=</span> <span class="n">dlon2de</span><span class="p">(</span><span class="n">filt_out</span><span class="o">.</span><span class="n">lon_err</span><span class="p">,</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>

    <span class="n">filt_DRMS</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">filt_out</span><span class="o">.</span><span class="n">n_err</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">filt_out</span><span class="o">.</span><span class="n">e_err</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FILT DRMS error = </span><span class="si">{</span><span class="n">filt_DRMS</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filt_out</span></div>


<div class="viewcode-block" id="eval_results_py">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.eval_results_py">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">eval_results_py</span><span class="p">(</span><span class="n">traj</span><span class="p">:</span> <span class="n">Traj</span><span class="p">,</span> <span class="n">ins</span><span class="p">:</span> <span class="n">INS</span><span class="p">,</span> <span class="n">filt_res</span><span class="p">:</span> <span class="n">FILTres</span><span class="p">,</span> <span class="n">crlb_P</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">CRLBout</span><span class="p">,</span> <span class="n">INSout</span><span class="p">,</span> <span class="n">FILTout</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract CRLB, INS, &amp; filter results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">crlb_out</span> <span class="o">=</span> <span class="n">eval_crlb_py</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">crlb_P</span><span class="p">)</span>
    <span class="n">ins_out</span>  <span class="o">=</span> <span class="n">eval_ins_py</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">ins</span><span class="p">)</span>
    <span class="n">filt_out</span> <span class="o">=</span> <span class="n">eval_filt_py</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">filt_res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">crlb_out</span><span class="p">,</span> <span class="n">ins_out</span><span class="p">,</span> <span class="n">filt_out</span></div>



<span class="c1"># --- Placeholder filter/CRLB functions (to be imported from actual modules) ---</span>
<div class="viewcode-block" id="placeholder_ekf_py">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.placeholder_ekf_py">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">placeholder_ekf_py</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FILTres</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Using placeholder EKF function.&quot;</span><span class="p">)</span>
    <span class="c1"># Determine N from ins or traj if possible</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ins&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">args</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">N_val</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">N</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ins</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">100</span> <span class="c1"># Default N</span>
    <span class="n">num_states</span> <span class="o">=</span> <span class="mi">18</span> <span class="c1"># Default number of states</span>
    <span class="k">return</span> <span class="n">FILTres</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_states</span><span class="p">,</span> <span class="n">N_val</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">,</span>
                   <span class="n">P</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">num_states</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_val</span><span class="p">)])</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span></div>


<div class="viewcode-block" id="placeholder_crlb_py">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.placeholder_crlb_py">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">placeholder_crlb_py</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Using placeholder CRLB function.&quot;</span><span class="p">)</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ins&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">args</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">N_val</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">N</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ins</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">100</span>
    <span class="n">num_states</span> <span class="o">=</span> <span class="mi">18</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">num_states</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.05</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_val</span><span class="p">)])</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span></div>


<span class="c1"># --- Main `run_filt` ---</span>
<span class="c1"># Map filter type symbols/strings to actual filter functions</span>
<span class="n">FILTER_DISPATCHER</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">FILTres</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ekf&quot;</span><span class="p">:</span> <span class="n">placeholder_ekf_py</span><span class="p">,</span>
    <span class="c1"># &quot;ekf_online&quot;: ekf_online_py, # Add actual functions when available</span>
    <span class="c1"># &quot;ekf_online_nn&quot;: ekf_online_nn_py,</span>
    <span class="c1"># &quot;mpf&quot;: mpf_py,</span>
    <span class="c1"># &quot;nekf&quot;: nekf_py,</span>
<span class="p">}</span>

<span class="n">CRLB_FUNCTION</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="n">placeholder_crlb_py</span>


<div class="viewcode-block" id="run_filt_py">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.run_filt_py">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">run_filt_py</span><span class="p">(</span>
    <span class="n">traj</span><span class="p">:</span> <span class="n">Traj</span><span class="p">,</span>
    <span class="n">ins</span><span class="p">:</span> <span class="n">INS</span><span class="p">,</span>
    <span class="n">meas</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="c1"># Scalar magnetometer measurements</span>
    <span class="n">itp_mapS</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="c1"># Map interpolation function f(lat,lon) or f(lat,lon,alt)</span>
    <span class="n">filt_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ekf&quot;</span><span class="p">,</span>
    <span class="n">P0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># create_P0_py()</span>
    <span class="n">Qd</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># create_Qd_py()</span>
    <span class="n">R</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">num_part</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1"># For MPF</span>
    <span class="n">thresh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># For MPF</span>
    <span class="n">baro_tau</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3600.0</span><span class="p">,</span>
    <span class="n">acc_tau</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3600.0</span><span class="p">,</span>
    <span class="n">gyro_tau</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3600.0</span><span class="p">,</span>
    <span class="n">fogm_tau</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">600.0</span><span class="p">,</span>
    <span class="n">date</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">get_years</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">185</span><span class="p">),</span> <span class="c1"># Decimal year</span>
    <span class="n">core</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># Include core field in measurement</span>
    <span class="n">map_alt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">x_nn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># For NN models</span>
    <span class="n">m_nn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>        <span class="c1"># NN model itself</span>
    <span class="n">y_norms_nn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># NN y_bias, y_scale</span>
    <span class="n">terms_tl</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;permanent&#39;</span><span class="p">,</span><span class="s1">&#39;induced&#39;</span><span class="p">,</span><span class="s1">&#39;eddy&#39;</span><span class="p">,</span><span class="s1">&#39;bias&#39;</span><span class="p">],</span> <span class="c1"># Tolles-Lawson</span>
    <span class="n">flux_tl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MagV</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># Vector mag data for online TL</span>
    <span class="n">x0_tl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># Initial TL states</span>
    <span class="n">extract</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">run_crlb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> <span class="c1"># Returns can be (CRLBout, INSout, FILTout), or FILTout, or (FILTres, crlb_P), or FILTres</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run navigation filter and optionally compute Cramér–Rao lower bound (CRLB).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">flux_tl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flux_tl</span> <span class="o">=</span> <span class="n">MagV</span><span class="p">()</span>

    <span class="c1"># Initialize P0, Qd, x0_tl if not provided (using placeholders for create_P0/Qd)</span>
    <span class="c1"># num_states = 18 # Common number of states</span>
    <span class="c1"># if P0 is None: P0 = np.eye(num_states) * 0.1 # Placeholder create_P0()</span>
    <span class="c1"># if Qd is None: Qd = np.eye(num_states) * 1e-4 # Placeholder create_Qd()</span>
    <span class="c1"># if x0_tl is None: x0_tl = np.ones(19) # Default for Tolles-Lawson</span>

    <span class="n">filter_func</span> <span class="o">=</span> <span class="n">FILTER_DISPATCHER</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filt_type</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_func</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filter type &#39;</span><span class="si">{</span><span class="n">filt_type</span><span class="si">}</span><span class="s2">&#39; not defined in FILTER_DISPATCHER.&quot;</span><span class="p">)</span>

    <span class="c1"># Prepare arguments for the specific filter function</span>
    <span class="c1"># This is a simplified example; actual filter functions will have specific signatures</span>
    <span class="n">filter_args</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;ins&quot;</span><span class="p">:</span> <span class="n">ins</span><span class="p">,</span> <span class="s2">&quot;meas&quot;</span><span class="p">:</span> <span class="n">meas</span><span class="p">,</span> <span class="s2">&quot;itp_mapS&quot;</span><span class="p">:</span> <span class="n">itp_mapS</span><span class="p">,</span>
        <span class="s2">&quot;P0&quot;</span><span class="p">:</span> <span class="n">P0</span><span class="p">,</span> <span class="s2">&quot;Qd&quot;</span><span class="p">:</span> <span class="n">Qd</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="n">R</span><span class="p">,</span>
        <span class="s2">&quot;baro_tau&quot;</span><span class="p">:</span> <span class="n">baro_tau</span><span class="p">,</span> <span class="s2">&quot;acc_tau&quot;</span><span class="p">:</span> <span class="n">acc_tau</span><span class="p">,</span> <span class="s2">&quot;gyro_tau&quot;</span><span class="p">:</span> <span class="n">gyro_tau</span><span class="p">,</span> <span class="s2">&quot;fogm_tau&quot;</span><span class="p">:</span> <span class="n">fogm_tau</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="s2">&quot;core&quot;</span><span class="p">:</span> <span class="n">core</span><span class="p">,</span> <span class="s2">&quot;map_alt&quot;</span><span class="p">:</span> <span class="n">map_alt</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">filt_type</span> <span class="o">==</span> <span class="s2">&quot;mpf&quot;</span><span class="p">:</span>
        <span class="n">filter_args</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;num_part&quot;</span><span class="p">:</span> <span class="n">num_part</span><span class="p">,</span> <span class="s2">&quot;thresh&quot;</span><span class="p">:</span> <span class="n">thresh</span><span class="p">})</span>
    <span class="c1"># Add args for ekf_online, ekf_online_nn, nekf as needed, e.g.:</span>
    <span class="c1"># if filt_type == &quot;ekf_online&quot;:</span>
    <span class="c1">#     filter_args.update({&quot;flux&quot;: flux_tl, &quot;x0_TL&quot;: x0_tl, &quot;terms&quot;: terms_tl})</span>
    <span class="c1"># if &quot;nn&quot; in filt_type or filt_type == &quot;nekf&quot;:</span>
    <span class="c1">#     filter_args.update({&quot;x_nn&quot;: x_nn, &quot;m&quot;: m_nn, &quot;y_norms&quot;: y_norms_nn})</span>

    <span class="n">filt_res</span> <span class="o">=</span> <span class="n">filter_func</span><span class="p">(</span><span class="o">**</span><span class="n">filter_args</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">run_crlb</span><span class="p">:</span>
        <span class="c1"># Prepare args for CRLB function</span>
        <span class="n">crlb_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;traj&quot;</span><span class="p">:</span> <span class="n">traj</span><span class="p">,</span> <span class="s2">&quot;itp_mapS&quot;</span><span class="p">:</span> <span class="n">itp_mapS</span><span class="p">,</span> <span class="c1"># Assuming crlb_py needs traj</span>
            <span class="s2">&quot;P0&quot;</span><span class="p">:</span> <span class="n">P0</span><span class="p">,</span> <span class="s2">&quot;Qd&quot;</span><span class="p">:</span> <span class="n">Qd</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="n">R</span><span class="p">,</span>
            <span class="s2">&quot;baro_tau&quot;</span><span class="p">:</span> <span class="n">baro_tau</span><span class="p">,</span> <span class="s2">&quot;acc_tau&quot;</span><span class="p">:</span> <span class="n">acc_tau</span><span class="p">,</span> <span class="s2">&quot;gyro_tau&quot;</span><span class="p">:</span> <span class="n">gyro_tau</span><span class="p">,</span> <span class="s2">&quot;fogm_tau&quot;</span><span class="p">:</span> <span class="n">fogm_tau</span><span class="p">,</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="s2">&quot;core&quot;</span><span class="p">:</span> <span class="n">core</span>
        <span class="p">}</span>
        <span class="n">crlb_P_matrix</span> <span class="o">=</span> <span class="n">CRLB_FUNCTION</span><span class="p">(</span><span class="o">**</span><span class="n">crlb_args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extract</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">eval_results_py</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">filt_res</span><span class="p">,</span> <span class="n">crlb_P_matrix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filt_res</span><span class="p">,</span> <span class="n">crlb_P_matrix</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">extract</span><span class="p">:</span>
            <span class="c1"># eval_filt_py is the one that returns FILTout</span>
            <span class="c1"># The Julia version calls eval_filt(traj,ins,filt_res) which returns FILTout</span>
            <span class="k">return</span> <span class="n">eval_filt_py</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">filt_res</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filt_res</span></div>



<div class="viewcode-block" id="run_filt_py_multiple">
<a class="viewcode-back" href="../../api_reference.html#magnavpy.eval_filt.run_filt_py_multiple">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">run_filt_py_multiple</span><span class="p">(</span>
    <span class="n">traj</span><span class="p">:</span> <span class="n">Traj</span><span class="p">,</span>
    <span class="n">ins</span><span class="p">:</span> <span class="n">INS</span><span class="p">,</span>
    <span class="n">meas</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">itp_mapS</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">filt_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="c1"># e.g., [&quot;ekf&quot;, &quot;ekf_online_nn&quot;]</span>
    <span class="o">**</span><span class="n">kwargs</span> <span class="c1"># Pass through all other keyword args from the single run_filt_py</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run multiple filter models and print their DRMS errors (nothing returned).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Default extract to True and run_crlb to False for this multi-run scenario</span>
    <span class="c1"># as per Julia version&#39;s behavior (prints DRMS, implies extraction, no CRLB typically)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;extract&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;run_crlb&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">filt_type_str</span> <span class="ow">in</span> <span class="n">filt_types</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Running </span><span class="si">{</span><span class="n">filt_type_str</span><span class="si">}</span><span class="s2"> filter ---&quot;</span><span class="p">)</span>
        <span class="c1"># The result of run_filt_py will be FILTout if extract=True, run_crlb=False</span>
        <span class="c1"># The DRMS is printed within eval_filt_py (called by run_filt_py)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">run_filt_py</span><span class="p">(</span>
            <span class="n">traj</span><span class="o">=</span><span class="n">traj</span><span class="p">,</span> <span class="n">ins</span><span class="o">=</span><span class="n">ins</span><span class="p">,</span> <span class="n">meas</span><span class="o">=</span><span class="n">meas</span><span class="p">,</span> <span class="n">itp_mapS</span><span class="o">=</span><span class="n">itp_mapS</span><span class="p">,</span>
            <span class="n">filt_type</span><span class="o">=</span><span class="n">filt_type_str</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Completed </span><span class="si">{</span><span class="n">filt_type_str</span><span class="si">}</span><span class="s2"> filter ---&quot;</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># Example Usage (requires actual Traj, INS, meas, itp_mapS, and filter/CRLB implementations)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;eval_filt.py example usage (requires full setup)&quot;</span><span class="p">)</span>

    <span class="c1"># Dummy data for demonstration if run directly</span>
    <span class="n">_N</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">_dt</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">_tt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">_N</span><span class="p">)</span> <span class="o">*</span> <span class="n">_dt</span>
    
    <span class="n">_traj</span> <span class="o">=</span> <span class="n">Traj</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">_N</span><span class="p">),</span> <span class="n">lon</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">_N</span><span class="p">),</span> <span class="n">alt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">_N</span><span class="p">),</span>
                 <span class="n">vn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">_N</span><span class="p">),</span> <span class="n">ve</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">_N</span><span class="p">),</span> <span class="n">vd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">_N</span><span class="p">),</span>
                 <span class="n">Cnb</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_N</span><span class="p">)]),</span> <span class="n">tt</span><span class="o">=</span><span class="n">_tt</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">_dt</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">_N</span><span class="p">)</span>
    <span class="n">_ins</span> <span class="o">=</span> <span class="n">INS</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">_traj</span><span class="o">.</span><span class="n">lat</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">_N</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">_traj</span><span class="o">.</span><span class="n">lon</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">_N</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span>
               <span class="n">alt</span><span class="o">=</span><span class="n">_traj</span><span class="o">.</span><span class="n">alt</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">_N</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">vn</span><span class="o">=</span><span class="n">_traj</span><span class="o">.</span><span class="n">vn</span><span class="p">,</span> <span class="n">ve</span><span class="o">=</span><span class="n">_traj</span><span class="o">.</span><span class="n">ve</span><span class="p">,</span> <span class="n">vd</span><span class="o">=</span><span class="n">_traj</span><span class="o">.</span><span class="n">vd</span><span class="p">,</span>
               <span class="n">Cnb</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_N</span><span class="p">)]),</span> <span class="n">P</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_N</span><span class="p">)])</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># Simplified P for pos only</span>
    <span class="n">_meas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">_N</span><span class="p">)</span> <span class="o">*</span> <span class="mi">50000</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_itp_mapS_dummy</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">alt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="k">return</span> <span class="mi">50000</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span>

    <span class="c1"># Test eval_filt_py directly</span>
    <span class="n">_num_states</span> <span class="o">=</span> <span class="mi">18</span>
    <span class="n">_filt_res_dummy</span> <span class="o">=</span> <span class="n">FILTres</span><span class="p">(</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">_num_states</span><span class="p">,</span> <span class="n">_N</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">_num_states</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_N</span><span class="p">)])</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># (18,18,N)</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Testing eval_filt_py:&quot;</span><span class="p">)</span>
    <span class="n">filt_out_obj</span> <span class="o">=</span> <span class="n">eval_filt_py</span><span class="p">(</span><span class="n">_traj</span><span class="p">,</span> <span class="n">_ins</span><span class="p">,</span> <span class="n">_filt_res_dummy</span><span class="p">)</span>
    <span class="c1"># print(f&quot;FILTout lat error mean: {np.mean(filt_out_obj.lat_err)}&quot;)</span>

    <span class="c1"># Test run_filt_py (using placeholder filter)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Testing run_filt_py (with placeholder EKF and CRLB):&quot;</span><span class="p">)</span>
    <span class="c1"># Need to provide P0, Qd for placeholder_crlb_py and placeholder_ekf_py if they use it</span>
    <span class="c1"># For simplicity, they currently don&#39;t strictly require them in the placeholder logic</span>
    <span class="c1"># but a real implementation would.</span>
    <span class="n">_P0_dummy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">_num_states</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
    <span class="n">_Qd_dummy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">_num_states</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-4</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">run_filt_py</span><span class="p">(</span>
        <span class="n">traj</span><span class="o">=</span><span class="n">_traj</span><span class="p">,</span> <span class="n">ins</span><span class="o">=</span><span class="n">_ins</span><span class="p">,</span> <span class="n">meas</span><span class="o">=</span><span class="n">_meas</span><span class="p">,</span> <span class="n">itp_mapS</span><span class="o">=</span><span class="n">_itp_mapS_dummy</span><span class="p">,</span>
        <span class="n">filt_type</span><span class="o">=</span><span class="s2">&quot;ekf&quot;</span><span class="p">,</span> <span class="n">P0</span><span class="o">=</span><span class="n">_P0_dummy</span><span class="p">,</span> <span class="n">Qd</span><span class="o">=</span><span class="n">_Qd_dummy</span><span class="p">,</span>
        <span class="n">extract</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run_crlb</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">results</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">crlb_o</span><span class="p">,</span> <span class="n">ins_o</span><span class="p">,</span> <span class="n">filt_o</span> <span class="o">=</span> <span class="n">results</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;run_filt_py returned CRLB DRMS (from print): ...&quot;</span><span class="p">)</span> <span class="c1"># DRMS printed inside</span>
</pre></div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2020-2023, Original MagNav.jl Authors; 2024-2025, Manas Pandey.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>